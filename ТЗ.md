### Техническое задание (ТЗ) на разработку Telegram-бота "3DPrintQueue"

1. Введение

1.1. Наименование проекта: Telegram-бот для управления очередью заказов на 3D-печать ("Robo548manufacturing").

1.2. Назначение и цели:
*   Назначение: Автоматизация процесса приема, обработки и учета заказов на 3D-печать.
*   Цели:
    *   Предоставить пользователям удобный интерфейс для оформления заказов.
    *   Обеспечить администратора инструментом для просмотра, модерации и отслеживания статусов заказов.
    *   Реализовать систему автоматических уведомлений для информирования пользователей.
    *   Стандартизировать процесс именования файлов моделей.

2. Описание системы

2.1. Роли пользователей:
*   Пользователь: Любой клиент, который взаимодействует с ботом для создания и отслеживания заказа.
*   Администратор: Уполномоченное лицо, управляющее очередью заказов, меняющее их статусы и имеющее доступ ко всем функциям.

3. Функциональные требования

3.1. Функционал для Пользователя:

*   3.1.1. Регистрация/Идентификация:
    *   При первом обращении бот запрашивает Фамилию, Имя и сохраняет их вместе с user_id Telegram.
*   3.1.2. Создание заказа:
    *   Команда /new_order или кнопка "Создать заказ".
    *   Процесс состоит из шагов:
        1.  Загрузка фото модели: Пользователь загружает изображение (подпись к фото опциональна).
        2.  Загрузка 3D-модели: Пользователь загружает файл. Бот проверяет расширение. Допустимы только .stl и .stp. В случае ошибки — уведомление.
        3.  Выбор типа пластика: Пользователь выбирает из списка, предоставленного администратором (напр., PLA, ABS, PETG, NYLON).
        4.  Выбор цвета пластика: Пользователь выбирает из списка цветов (напр., Белый, Черный, Красный и т.д.). Списки типов и цветов должны быть редактируемыми через админ-панель.
        5.  Подтверждение заказа: Бот показывает сводку по заказу (ФИО, фото, выбранные материалы). Пользователь подтверждает или отменяет создание.
*   3.1.3. Просмотр моих заказов:
    *   Команда /my_orders выводит список всех заказов пользователя с их текущими статусами (в виде кнопок или списка).
*   3.1.4. Уведомления:
    *   Пользователь автоматически получает уведомление в личный чат с ботом при смене статуса его заказа.

3.2. Функционал для Администратора:

*   3.2.1. Авторизация:
    *   Список user_id администраторов хранится в файле конфигурации/БД. При обращении к боту происходит проверка прав.
*   3.2.2. Просмотр очереди заказов:
    *   Команда /admin открывает панель администратора.
    *   Возможность просмотра заказов по статусам: "В ожидании", "В работе", "Готов", "Отклонен", "Все заказы".
*   3.2.3. Детальный просмотр заказа:
    *   При выборе заказа из списка администратору отображается:
        *   Номер заказа, дата создания.
        *   ФИО заказчика, его Telegram ID (ссылка).
        *   Прикрепленное фото модели (с подписью, если есть).
        *   Выбранные тип и цвет пластика.
        *   Текущий статус.
        *   Кнопка "Скачать модель".
*   3.2.4. Управление статусами заказа:
    *   В интерфейсе просмотра заказа должны быть кнопки для смены статуса: "Принять в работу", "Готов", "Отклонить" и т.д.
*   3.2.5. Скачивание 3D-модели:
    *   При нажатии кнопки "Скачать модель" бот должен отправить администратору файл.
    *   Критически важно: Файл должен быть переименован по шаблону: {НомерЗаказа}_{Фамилия}_{Имя}_{НазваниеДетали}.stp (или .stl).
        *   НазваниеДетали берется из оригинального названия файла, загруженного пользователем (без расширения), или из отдельного поля, если оно было введено. *Лучше уточнить в реализации: запрашивать название детали у пользователя отдельно при создании заказа.*
*   3.2.6. Управление материалами (дополнительно):
    *   Команда /manage_materials позволяет через простой интерфейс (кнопки "Добавить", "Удалить") редактировать списки доступных типов пластика и цветов.

4. Нефункциональные требования

*   4.1. Производительность: Бот должен стабильно работать при одновременном обращении до 50 пользователей.
*   4.2. Безопасность:
    *   Доступ к админ-функциям только по user_id.
    *   Валидация загружаемых файлов.
*   4.3. Масштабируемость: Архитектура должна позволять легко добавлять новые статусы заказов или типы материалов.
*   4.4. Хранение данных:
    *   Использование базы данных (предпочтительно SQLite для простоты или PostgreSQL).
    *   Структура БД должна включать таблицы: Users, Orders, Statuses, Materials, Colors.
    *   Файлы (фото и 3D-модели) могут храниться либо в файловой системе сервера (с путями в БД).
*   4.5 Логирование:
    *   исползуй модуль loguru(устанавливается через pip) для логирования в консоль и в файл 

1. Требования к интерфейсу

*   5.1. Типы интерфейсов: Взаимодействие осуществляется исключительно через чат Telegram с использованием кнопок (ReplyKeyboardMarkup, InlineKeyboardMarkup) для минимизации ручного ввода.
*   5.2. Локализация: Русский язык.

6. Логика работы и сценарии

6.1. Сценарий "Создание заказа":
1.  Пользователь -> /new_order
2.  Бот: "Загрузите фото вашей модели (скриншот, чертеж)"
3.  Пользователь -> [Загружает фото]
4.  Бот: "Теперь загрузите файл 3D-модели в формате STL или STP"
5.  Пользователь -> [Загружает файл MyPart.stl]
    *   *Если файл не .stl/.stp -> "Неверный формат. Допустимы только STL и STP."*
6.  Бот: "Введите название детали" (*Опциональный, но рекомендуемый шаг для удобства именования*)
7.  Пользователь -> "Корпус_устройства_v2"
8.  Бот: "Выберите тип пластика" -> [Кнопки: PLA, ABS, PETG]
9.  Пользователь -> PLA
10. Бот: "Выберите цвет" -> [Кнопки: Белый, Черный, Синий]
11. Пользователь -> Синий
12. Бот: "Проверьте данные заказа: ... Всё верно?"
13. Пользователь -> [Кнопка "Подтвердить"]
14. Бот: "Ваш заказ №105 создан и принят в очередь! Статус: 'В ожидании'".

6.2. Сценарий "Обработка заказа администратором":
1.  Админ -> /admin -> "Заказы в ожидании" -> Выбирает заказ №105.
2.  Бот показывает все данные заказа и кнопки "Скачать модель", "В работу", "Отклонить".
3.  Админ -> "Скачать модель". Бот отправляет файл с именем 105_Иванов_Петр_Корпус_устройства_v2.stl.
4.  Админ -> "В работу".
5.  *Пользователь получает уведомление: "Ваш заказ №105 переведен в статус 'В работе'."*
6.  Админ -> "Готов".
7.  *Пользователь получает уведомление: "Ваш заказ №105 готов к выдаче!"*

7. Этапы разработки и приемки

*   Этап 1: Базовая настройка бота, структура БД, функционал пользователя (регистрация, создание заказа).
*   Этап 2: Функционал администратора (просмотр, смена статуса, скачивание файлов с переименованием).
*   Этап 3: Система уведомлений, обработка ошибок, тестирование.
*   Этап 4: Финальная приемка и развертывание на продакшен-сервере.